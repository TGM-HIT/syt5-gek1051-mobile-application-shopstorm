(this["webpackJsonpshopping-list-react-pouchdb"]=this["webpackJsonpshopping-list-react-pouchdb"]||[]).push([[0],{131:function(e,t,s){e.exports=s(292)},266:function(e,t){},287:function(e,t,s){},290:function(e,t,s){},291:function(e,t,s){"use strict";s.r(t);t.default={cloudant_url:"http://username:password@host:port/databasename"}},292:function(e,t,s){"use strict";s.r(t);var i=s(0),n=s.n(i),o=s(13),a=s.n(o),l=s(50),p=s(119),h=s.n(p),r=s(79),c=s.n(r),m=s(120),d=s.n(m),g=s(34),u=s.n(g),L=s(22),S=s.n(L),y=s(121),C=s.n(y),E=s(122),I=s.n(E),b=s(35),f=s.n(b),k=s(24),w=s.n(k),v=s(26),N=s(19),R=s.n(N),x=s(123),O=s.n(x),T=s(124),B=s.n(T),F=s(125),_=s.n(F),D=s(25),A=s(46),P=s(57),W=s.n(P),U=s(36),j=s.n(U),q=s(58),G=s.n(q),H=s(59),M=s.n(H);s(287);const z=n.a.createElement(R.a,{touch:!0,tooltip:"more",tooltipPosition:"bottom-left"},n.a.createElement(M.a,null));class J extends n.a.Component{constructor(){super(...arguments),this.state={open:!1,activeListId:"",oldName:"",newName:""},this.handleOpen=(e,t)=>{this.setState({open:!0,activeListId:e,oldName:t})},this.handleClose=()=>{this.setState({open:!1})},this.handleSubmit=e=>{this.props.renameListFunc(this.state.activeListId,this.state.newName),this.handleClose()},this.updateName=e=>{this.setState({newName:e.target.value})}}render(){const e=[n.a.createElement(S.a,{label:"Cancel",primary:!0,onClick:this.handleClose}),n.a.createElement(S.a,{label:"Submit",primary:!0,keyboardFocused:!0,onClick:this.handleSubmit})];let t=this.props.shoppingLists.map(e=>n.a.createElement(v.Card,{key:e._id,style:{margin:"12px 0"}},n.a.createElement(v.CardTitle,{title:e.title,children:n.a.createElement(G.a,{iconButtonElement:z,className:"vertmenu-list"},n.a.createElement(j.a,{primaryText:"Open",onClick:()=>this.props.openListFunc(e._id)}),n.a.createElement(j.a,{primaryText:"Rename",onClick:()=>this.handleOpen(e._id,e.title)}),n.a.createElement(j.a,{primaryText:"Delete",onClick:()=>this.props.deleteListFunc(e._id)}))}),n.a.createElement(v.CardActions,null,n.a.createElement(W.a,{label:(this.props.checkedCounts.get(e._id)||0)+" of "+(this.props.totalCounts.get(e._id)||0)+" items checked",checked:e.checked,onCheck:()=>this.props.checkAllFunc(e._id)}))));return n.a.createElement("div",null,n.a.createElement("div",null,t),n.a.createElement(u.a,{title:"Rename Item",actions:e,modal:!1,open:this.state.open,onRequestClose:this.handleClose},n.a.createElement(f.a,{className:"form-control",type:"text",id:"textfield-item-rename",defaultValue:this.state.oldName,onChange:this.updateName,fullWidth:!0})))}}var V=J,K=s(126),$=s(127),Q=s.n($);s(290);const X=n.a.createElement(R.a,{touch:!0,tooltip:"more",tooltipPosition:"bottom-left"},n.a.createElement(M.a,null));class Y extends n.a.Component{constructor(){super(...arguments),this.state={open:!1,activeItemId:"",oldName:"",newName:""},this.handleOpen=(e,t)=>{this.setState({open:!0,activeItemId:e,oldName:t})},this.handleClose=()=>{this.setState({open:!1})},this.handleSubmit=e=>{this.props.renameItemFunc(this.state.activeItemId,this.state.newName),this.handleClose()},this.updateName=e=>{this.setState({newName:e.target.value})}}render(){const e=[n.a.createElement(S.a,{label:"Cancel",primary:!0,onClick:this.handleClose}),n.a.createElement(S.a,{label:"Submit",primary:!0,keyboardFocused:!0,onClick:this.handleSubmit})];let t=this.props.shoppingListItems.map(e=>n.a.createElement("div",{key:"listitem_"+e._id},n.a.createElement(K.ListItem,{className:"shoppinglistitem",primaryText:n.a.createElement("span",{className:e.checked?"checkeditem":"uncheckeditem"},e.title),leftCheckbox:n.a.createElement(W.a,{onCheck:this.props.toggleItemCheckFunc,"data-item":e._id,"data-id":e._id,checked:e.checked}),rightIconButton:n.a.createElement(G.a,{iconButtonElement:X,className:"vertmenu-list"},n.a.createElement(j.a,{primaryText:"Rename",onClick:()=>this.handleOpen(e._id,e.title)}),n.a.createElement(j.a,{primaryText:"Delete",onClick:()=>this.props.deleteFunc(e._id)}))}),n.a.createElement(Q.a,{inset:!0})));return n.a.createElement("div",null,n.a.createElement("div",null,t),n.a.createElement(u.a,{title:"Rename Item",actions:e,modal:!1,open:this.state.open,onRequestClose:this.handleClose},n.a.createElement(f.a,{className:"form-control",type:"text",id:"textfield-item-rename",defaultValue:this.state.oldName,onChange:this.updateName,fullWidth:!0})))}}var Z=Y;const ee=c()({palette:{textColor:D.grey800,alternateTextColor:D.white,primary1Color:D.pinkA100,accent1Color:D.blueGrey500}}),te={backgroundColor:D.blueGrey500,width:"100%"};class se extends n.a.Component{constructor(e){super(e),this.componentDidMount=()=>{this.getShoppingLists(),this.remoteDB&&this.syncToRemote()},this.syncToRemote=()=>{this.props.localDB.sync(this.remoteDB,{live:!0,retry:!0}).on("change",e=>{this.getPouchDocs()}).on("error",e=>console.log("uh oh! an error occured while synching."))},this.getShoppingLists=()=>{let e=Object(l.List)(),t=Object(l.List)(),s=null;this.props.shoppingListRepository.find().then(e=>(console.log("GOT SHOPPING LISTS FROM POUCHDB. COUNT: "+e.size),s=e,e)).then(e=>this.props.shoppingListRepository.findItemsCountByList()).then(e=>(console.log("TOTAL COUNT LIST"),console.log(e),t=e,this.props.shoppingListRepository.findItemsCountByList({selector:{type:"item",checked:!0},fields:["list"]}))).then(i=>{console.log("CHECKED LIST"),console.log(i),e=i,this.setState({view:"lists",shoppingLists:s,shoppingList:null,shoppingListItems:null,checkedTotalShoppingListItemCount:e,totalShoppingListItemCount:t})})},this.openShoppingList=e=>{this.props.shoppingListRepository.get(e).then(e=>e).then(t=>{this.getShoppingListItems(e).then(e=>{this.setState({view:"items",shoppingList:t,shoppingListItems:e})})})},this.getShoppingListItems=e=>this.props.shoppingListRepository.findItems({selector:{type:"item",list:e}}),this.refreshShoppingListItems=e=>{this.props.shoppingListRepository.findItems({selector:{type:"item",list:e}}).then(e=>{this.setState({view:"items",shoppingListItems:e})})},this.renameShoppingListItem=(e,t)=>{console.log("IN renameShoppingListItem with id="+e+", name="+t),this.props.shoppingListRepository.getItem(e).then(e=>(e=e.set("title",t),this.props.shoppingListRepository.putItem(e))).then(this.refreshShoppingListItems(this.state.shoppingList._id))},this.deleteShoppingListItem=e=>{this.props.shoppingListRepository.getItem(e).then(e=>this.props.shoppingListRepository.deleteItem(e)).then(this.refreshShoppingListItems(this.state.shoppingList._id))},this.toggleItemCheck=e=>{let t=e.target.dataset.id;this.props.shoppingListRepository.getItem(t).then(e=>(e=e.set("checked",!e.checked),this.props.shoppingListRepository.putItem(e))).then(this.refreshShoppingListItems(this.state.shoppingList._id))},this.checkAllListItems=e=>{let t=!0;this.getShoppingListItems(e).then(e=>{let s=[];e.forEach(e=>{e.checked||s.push(e.mergeDeep({checked:!0}))},this),0===s.length&&(t=!1,e.forEach(e=>{s.push(e.mergeDeep({checked:!1}))},this));let i=this.props.shoppingListFactory.newListOfShoppingListItems(s);return this.props.shoppingListRepository.putItemsBulk(i)}).then(t=>this.props.shoppingListRepository.get(e)).then(e=>(e=e.set("checked",t),this.props.shoppingListRepository.put(e))).then(e=>{this.getShoppingLists()})},this.deleteShoppingList=e=>{this.props.shoppingListRepository.get(e).then(e=>(e=e.set("_deleted",!0),this.props.shoppingListRepository.put(e))).then(e=>{this.getShoppingLists()})},this.renameShoppingList=(e,t)=>{this.props.shoppingListRepository.get(e).then(e=>(e=e.set("title",t),this.props.shoppingListRepository.put(e))).then(this.getShoppingLists)},this.createNewShoppingListOrItem=e=>{if(e.preventDefault(),this.setState({adding:!1}),"lists"===this.state.view){let e=this.props.shoppingListFactory.newShoppingList({title:this.state.newName});this.props.shoppingListRepository.put(e).then(this.getShoppingLists)}else if("items"===this.state.view){let e=this.props.shoppingListFactory.newShoppingListItem({title:this.state.newName},this.state.shoppingList);this.props.shoppingListRepository.putItem(e).then(e=>{this.getShoppingListItems(this.state.shoppingList._id).then(e=>{this.setState({view:"items",shoppingListItems:e})})})}},this.updateName=e=>{this.setState({newName:e.target.value})},this.displayAddingUI=()=>{this.setState({adding:!0})},this.renderNewNameUI=()=>n.a.createElement("form",{onSubmit:this.createNewShoppingListOrItem,style:{marginTop:"12px"}},n.a.createElement(w.a,null,n.a.createElement(f.a,{className:"form-control",type:"text",autoFocus:!0,hintText:"Name...",onChange:this.updateName,fullWidth:!1,style:{padding:"0px 12px",width:"calc(100% - 24px)"},underlineStyle:{width:"calc(100% - 24px)"}}))),this.renderShoppingLists=()=>this.state.shoppingLists.length<1?n.a.createElement(v.Card,{style:{margin:"12px 0"}},n.a.createElement(v.CardTitle,{title:"Click the + sign below to create a shopping list."})):n.a.createElement(V,{shoppingLists:this.state.shoppingLists,openListFunc:this.openShoppingList,deleteListFunc:this.deleteShoppingList,renameListFunc:this.renameShoppingList,checkAllFunc:this.checkAllListItems,totalCounts:this.state.totalShoppingListItemCount,checkedCounts:this.state.checkedTotalShoppingListItemCount}),this.renderShoppingListItems=()=>this.state.shoppingListItems.size<1?n.a.createElement(v.Card,{style:{margin:"12px 0"}},n.a.createElement(v.CardTitle,{title:"Click the + sign below to create a shopping list item."})):n.a.createElement(Z,{shoppingListItems:this.state.shoppingListItems,deleteFunc:this.deleteShoppingListItem,toggleItemCheckFunc:this.toggleItemCheck,renameItemFunc:this.renameShoppingListItem}),this.renderBackButton=()=>"items"===this.state.view?n.a.createElement(R.a,{touch:!0,onClick:this.getShoppingLists},n.a.createElement(O.a,null)):n.a.createElement("img",{src:"cart_sm.png",width:"48px",alt:"Shopping List app logo"}),this.renderActionButtons=()=>{const e={fill:"white"};return n.a.createElement("div",null,n.a.createElement(R.a,{touch:!0,onClick:this.handleOpenSettings,iconStyle:e},n.a.createElement(B.a,null)),n.a.createElement(R.a,{touch:!0,onClick:this.handleOpenAbout,iconStyle:e},n.a.createElement(_.a,null)))},this.handleOpenSettings=()=>{this.setState({settingsOpen:!0})},this.handleCloseSettings=()=>{this.setState({settingsOpen:!1})},this.handleOpenAbout=()=>{this.setState({aboutOpen:!0})},this.handleCloseAbout=()=>{this.setState({aboutOpen:!1})},this.handleSubmitSettings=()=>{try{this.remoteDB=new A.a(this.tempdburl),this.syncToRemote()}catch(e){console.log("Error setting remote database: "),console.log(e)}this.handleCloseSettings()},this.showSettingsDialog=()=>{const e=[n.a.createElement(S.a,{label:"Cancel",primary:!1,keyboardFocused:!0,onClick:this.handleCloseSettings}),n.a.createElement(S.a,{label:"Submit",primary:!0,onClick:this.handleSubmitSettings})];return n.a.createElement(u.a,{title:"Shopping List Settings",actions:e,modal:!1,open:this.state.settingsOpen,onRequestClose:this.handleCloseSettings},n.a.createElement("p",null,"Enter a fully qualified URL (including username and password) to a remote IBM Cloudant, Apache CouchDB, or PouchDB database to sync your shopping list."),n.a.createElement(f.a,{id:"db-url",floatingLabelText:"https://username:password@localhost:5984/database",fullWidth:!0,onChange:e=>{this.tempdburl=e.target.value}}))},this.showAboutDialog=()=>{const e=[n.a.createElement(S.a,{label:"Close",primary:!1,keyboardFocused:!0,onClick:this.handleCloseAbout})];return n.a.createElement(u.a,{title:"About",actions:e,modal:!1,open:this.state.aboutOpen,onRequestClose:this.handleAboutSettings},n.a.createElement("p",null,n.a.createElement("a",{href:"https://github.com/ibm-watson-data-lab/shopping-list",target:"_blank",rel:"noopener noreferrer"},"Shopping List is a series of Offline First demo apps, each built using a different stack."),"These demo apps cover Progressive Web Apps, hybrid mobile apps, native mobile apps, and desktop apps. This particular demo app is a ",n.a.createElement("strong",null,"Progressive Web App"),"built using ",n.a.createElement("strong",null,"React and PouchDB"),". ",n.a.createElement("a",{href:"https://github.com/ibm-watson-data-lab/shopping-list-react-pouchdb",target:"_blank",rel:"noopener noreferrer"},"Get the source code"),"."))},this.remoteDB=e.remoteDB,this.state={shoppingList:null,shoppingLists:[],totalShoppingListItemCount:Object(l.List)(),checkedTotalShoppingListItemCount:Object(l.List)(),shoppingListItems:null,adding:!1,view:"lists",newName:"",settingsOpen:!1,aboutOpen:!1}}render(){let e="Shopping List";return"items"===this.state.view&&(e=this.state.shoppingList.title),n.a.createElement(h.a,{muiTheme:ee},n.a.createElement("div",{className:"App"},n.a.createElement(d.a,{title:e,iconElementLeft:this.renderBackButton(),style:te,iconElementRight:this.renderActionButtons()}),n.a.createElement("div",{className:"listsanditems",style:{margin:"8px"}},this.state.adding?this.renderNewNameUI():n.a.createElement("span",null),"lists"===this.state.view?this.renderShoppingLists():this.renderShoppingListItems()),this.state.settingsOpen?this.showSettingsDialog():n.a.createElement("span",null),this.state.aboutOpen?this.showAboutDialog():n.a.createElement("span",null),n.a.createElement(C.a,{onClick:this.displayAddingUI,mini:!0,style:{position:"fixed",bottom:"25px",right:"25px"}},n.a.createElement(I.a,null))))}}var ie=se;const ne=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function oe(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(e=>{console.error("Error during service worker registration:",e)})}var ae=s(81),le=s(128);A.a.plugin(le.a);const pe=new A.a("shopping_list_react");let he=void 0;try{let e=s(291);e.default.cloudant_url&&(he=new A.a(e.default.cloudant_url))}catch(me){console.log("secret.js file missing; disabling remote sync.")}const re=new ae.ShoppingListFactory,ce=new ae.ShoppingListRepositoryPouchDB(pe);!function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="/service-worker.js";ne?function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):oe(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):oe(e)})}}(),ce.ensureIndexes().then(e=>{a.a.render(n.a.createElement(ie,{shoppingListFactory:re,shoppingListRepository:ce,localDB:pe,remoteDB:he}),document.getElementById("root"))}).catch(e=>{console.log("in put catch"),console.log(e)})}},[[131,1,2]]]);
//# sourceMappingURL=main.ce08bb5c.chunk.js.map